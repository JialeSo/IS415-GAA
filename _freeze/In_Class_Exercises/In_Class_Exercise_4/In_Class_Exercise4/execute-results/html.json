{
  "hash": "e60e7826229f76053e3f1f76f2ae7f1d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In Class Exercise 4: Spatio-Temporal Point Patterns Analysis\"\nauthor: \"Jiale SO\"\ndate: \"September 09, 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true  \n  echo: true\n  freeze: true\n  warning: false\n  message: false\n  cache: true\n---\n\n\n# 1.0 Introduction\n\nA spatio-temporal point process (also called space-time or spatial-temporal point process) is a random collection of points, where each point represents the time and location of an event. Examples of events include incidence of disease, sightings or births of a species, or the occurrences of fires, earthquakes, lightning strikes, tsunamis, or volcanic eruptions.\n\nThe analysis of spatio-temporal point patterns is becoming increasingly necessary, given the rapid emergence of geographically and temporally indexed data in a wide range of fields. Several spatio-temporal point patterns analysis methods have been introduced and implemented in R in the last ten years. This chapter shows how various R packages can be combined to run a set of spatio-temporal point pattern analyses in a guided and intuitive way. A real world forest fire events in Kepulauan Bangka Belitung, Indonesia from 1st January 2023 to 31st December 2023 is used to illustrate the methods, procedures and interpretations.\n\n## 1.1 Research Questions\n\nThe specific question we would like to answer is:\n\n-   are the locations of forest fire in Kepulauan Bangka Belitung spatial and spatio-temporally independent?\n\n-   if the answer is NO, where and when the observed forest fire locations tend to cluster?\n\n# 2.0 Setup and Requirements\n\nFor the purpose of this study, five R packages will be used. They are:\n\n-   `rgdal` for importing geospatial data in GIS file format such as shapefile into R and save them as Spatial\\*DataFrame,\n\n-   `maptools` for converting Spatial\\* object into ppp object,\n\n-   `raster` for handling raster data in R,\n\n-   `sparr` provides function to estimate fixed and adaptive kernel-smoothed spatial relative risk surfaces via the density-ratio method and perform subsequent inference. fixed-bandwidth spati=temporal density and relative risk estimation is also supported\n\n-   `spatstat` for performing Spatial Point Patterns Analysis such as kcross, Lcross, etc., and\n\n-   `tmap` for producing cartographic quality thematic maps.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, raster, spatstat, sparr, tmap, tidyverse, stpp, skimr)\n```\n:::\n\n\n# 3.0 Importing the Data Sets.\n\nFor the purpose of this exercise, two data sets are used, they are:\n\n-   forestfires, a csv file provides locations of forest fire detected from the Moderate Resolution Imaging Spectroradiometer (MODIS) sensor data. The data are downloaded from [Fire Information for Resource Management System](https://firms.modaps.eosdis.nasa.gov/download/). For the purpose of this exercise, only forest fires within Kepulauan Bangka Belitung will be used.\n\n-   Kepulauan_Bangka_Belitung, an ESRI shapefile showing the sub-district (i.e. [kelurahan](https://en.wikipedia.org/wiki/Villages_of_Indonesia)) boundary of Kepulauan Bangka Belitung. The data set was downloaded from [Indonesia Geospatial](https://www.indonesia-geospasial.com/2023/05/download-shapefile-batas-administrasi.html) portal. The original data covers the whole Indonesia. For the purpose of this exercise, only sub-districts within Kepulauan Bangka Belitung are extracted\n\n::: panel-tabset\n### Forest Fire\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforestFire_sf <- read_csv(\"data/rawdata/forestfires.csv\") %>%\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) %>%\n  st_transform(crs = 32748)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nforestFire_sf <- forestFire_sf %>%\n  mutate(DayofYear = yday(acq_date)) %>%\n  mutate(Month_num = month(acq_date)) %>%\n  mutate(Month_fac = month(acq_date, label = TRUE, abbr = FALSE)) \n```\n:::\n\n\n### Kepulauan Shape File\n\nImporting the study area.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkbb_sf <- st_read(dsn = \"data/rawdata\", layer=\"Kepulauan_Bangka_Belitung\") %>%\n  st_union %>%\n  st_zm(drop = TRUE, what = \"ZM\") %>%\n  st_transform(crs = 32748)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Kepulauan_Bangka_Belitung' from data source \n  `C:\\Users\\jiale\\Desktop\\IS415\\IS415-GAA\\In_Class_Exercises\\In_Class_Exercise_4\\data\\rawdata' \n  using driver `ESRI Shapefile'\nSimple feature collection with 298 features and 27 fields\nGeometry type: POLYGON\nDimension:     XYZ\nBounding box:  xmin: 105.1085 ymin: -3.116593 xmax: 106.8488 ymax: -1.501603\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\nConvert to own\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkbb_owin <- as.owin(kbb_sf)\nkbb_owin\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nwindow: polygonal boundary\nenclosing rectangle: [512066.8, 705559.4] x [9655398, 9834006] units\n```\n\n\n:::\n\n```{.r .cell-code}\nclass(kbb_owin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"owin\"\n```\n\n\n:::\n:::\n\n:::\n\n# 4.0 Visualizing the Fire Points\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(kbb_sf) +\n  tm_polygons() +\n  tm_shape(forestFire_sf) +\n    tm_dots()\n```\n\n::: {.cell-output-display}\n![](In_Class_Exercise4_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(kbb_sf) +\n  tm_polygons() +\n  tm_shape(forestFire_sf) +\n    tm_dots(size = 0.1) +\n  tm_facets(by=\"Month_fac\",\n            free.coords = FALSE,\n            drop.units = TRUE)\n```\n\n::: {.cell-output-display}\n![](In_Class_Exercise4_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # Plot the map of Kepulauan Bangka Belitung\n  geom_sf(data = kbb_sf, fill = \"lightgreen\", color = \"darkgreen\") +\n  # Plot the forest fire points, colored by month\n  geom_sf(data = forestFire_sf, aes(color = Month_fac), size = 2) +\n  # Customize the theme\n  theme_minimal() +\n  labs(\n    title = \"Forest Fires in Kepulauan Bangka Belitung\",\n    subtitle = \"Mapped by Month\",\n    color = \"Month\",\n    caption = \"Source: Forest Fire Data\"\n  ) +\n  theme(\n    plot.title = element_text(hjust = 0.5),\n    plot.subtitle = element_text(hjust = 0.5)\n  )\n```\n\n::: {.cell-output-display}\n![](In_Class_Exercise4_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n# 5.0 Computing the STKDE By Month\n\n## 5.1 Extracting forest fire by months\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month <- forestFire_sf %>%\n  dplyr::select(Month_num)\n```\n:::\n\n\n## 5.2 Creating the PPP\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month_ppp <- as.ppp(fire_month)\nfire_month_ppp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMarked planar point pattern: 741 points\nmarks are numeric, of storage type  'double'\nwindow: rectangle = [521564.1, 695791] x [9658137, 9828767] units\n```\n\n\n:::\n:::\n\n\n## 5.3 Including Owin Object\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfire_month_owin <- fire_month_ppp[kbb_owin]\nhead(fire_month_owin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMarked planar point pattern: 6 points\nmarks are numeric, of storage type  'double'\nwindow: polygonal boundary\nenclosing rectangle: [512066.8, 705559.4] x [9655398, 9834006] units\n```\n\n\n:::\n\n```{.r .cell-code}\nglimpse(fire_month_owin)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 6\n $ window    :List of 5\n  ..$ type  : chr \"polygonal\"\n  ..$ xrange: num [1:2] 512067 705559\n  ..$ yrange: num [1:2] 9655398 9834006\n  ..$ bdry  :List of 2\n  .. ..$ :List of 2\n  .. ..$ :List of 2\n  ..$ units :List of 3\n  .. ..$ singular  : chr \"unit\"\n  .. ..$ plural    : chr \"units\"\n  .. ..$ multiplier: num 1\n  .. ..- attr(*, \"class\")= chr \"unitname\"\n  ..- attr(*, \"class\")= chr \"owin\"\n $ n         : int 741\n $ x         : num [1:741] 606179 661411 637809 654882 669934 ...\n $ y         : num [1:741] 9703062 9683536 9682757 9690665 9697468 ...\n $ markformat: chr \"vector\"\n $ marks     : num [1:741] 1 1 1 1 1 1 1 1 1 1 ...\n - attr(*, \"class\")= chr \"ppp\"\n```\n\n\n:::\n\n```{.r .cell-code}\nskim(fire_month_owin)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |                |\n|:------------------------|:---------------|\n|Name                     |fire_month_owin |\n|Number of rows           |741             |\n|Number of columns        |3               |\n|_______________________  |                |\n|Column type frequency:   |                |\n|numeric                  |3               |\n|________________________ |                |\n|Group variables          |None            |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|       mean|       sd|        p0|       p25|       p50|       p75|    p100|hist  |\n|:-------------|---------:|-------------:|----------:|--------:|---------:|---------:|---------:|---------:|-------:|:-----|\n|x             |         0|             1|  620811.99| 39443.39|  521564.1|  595009.7|  624170.1|  653519.9|  695791|▂▅▇▇▅ |\n|y             |         0|             1| 9733857.60| 44333.24| 9658137.5| 9696276.9| 9722669.8| 9774209.8| 9828767|▆▇▃▆▃ |\n|marks         |         0|             1|       8.58|     2.04|       1.0|       8.0|       9.0|      10.0|      12|▁▁▃▇▇ |\n\n\n:::\n:::\n\n\n## 5.4 Computing Spatio-temporal KDE\n\n`Spattemp.density()` of sparr package is used to compute the STYKDE.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_kde <- spattemp.density(fire_month_owin)\nsummary(st_kde)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSpatiotemporal Kernel Density Estimate\n\nBandwidths\n  h = 15102.47 (spatial)\n  lambda = 0.0304 (temporal)\n\nNo. of observations\n  741 \n\nSpatial bound\n  Type: polygonal\n  2D enclosure: [512066.8, 705559.4] x [9655398, 9834006]\n\nTemporal bound\n  [1, 12]\n\nEvaluation\n  128 x 128 x 12 trivariate lattice\n  Density range: [1.233458e-27, 8.202976e-10]\n```\n\n\n:::\n:::\n\n\n## 5.5 Plotting the spatio-temporal KDE Object\n\nplot for the KDE between july 2023 = december 2023.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntims <- c(7,8,9,10,11,12)\n par(mfcol = c(2,3))\n for(i in tims) {\n   plot(st_kde, i,\n        override.par=FALSE,\n        fix.range = TRUE,\n        main = paste(\"KDE at month\", i)\n        )\n }\n```\n\n::: {.cell-output-display}\n![](In_Class_Exercise4_files/figure-html/unnamed-chunk-13-1.png){width=1152}\n:::\n:::\n\n\n# 6.0 Computing STKDE By Day Of Year\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}